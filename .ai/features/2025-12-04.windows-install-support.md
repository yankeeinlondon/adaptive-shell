# Feature: Windows Installation Support

## Feature Description

Add Windows installation support to `install_jq()`, `install_curl()`, and `install_yq()` functions in `utils/install.sh`. This enables these common CLI tools to be automatically installed on Windows systems using the existing `is_windows()` detection and a new `install_on_windows()` helper function.

Windows installation will use **winget** (Windows Package Manager) as the primary package manager, with **Chocolatey** and **Scoop** as fallbacks. These are the three most common package managers for Windows CLI tools.

## Files Affected

### Modified Files
- `utils/install.sh` - Add `install_on_windows()` function and Windows branches to:
  - `install_jq()`
  - `install_curl()`
  - `install_yq()`

### Test Files
- `tests/unit/install.test.ts` - Existing tests (may need mock updates)
- `tests/unit/WIP/install-windows.test.ts` - New tests for Windows support
- `tests/helpers/install-mocks.sh` - May need Windows package manager mocks

## Test Scope

**Glob Pattern:** `tests/unit/*install*.test.ts`

**Test Command:**
```bash
pnpm test tests/unit/install.test.ts tests/unit/WIP/install-windows.test.ts
```

## Baseline Test Status

```bash
pnpm test tests/unit/install.test.ts
```

- **Total tests in scope:** 53 tests
- **Passing:** 53
- **Failing:** 0
- **Pre-existing failures:** None

## Implementation Checklist

- [ ] Step 2: Planning - Design `install_on_windows()` and integration approach
- [ ] Step 3: Unit Tests - Create comprehensive tests for Windows installation
- [ ] Step 4: Implementation - Implement Windows support
- [ ] Step 5: Review - Self-review and document findings

---

## Step 2: Planning

### Architecture

The implementation follows the existing pattern established by `install_on_macos()`, `install_on_debian()`, etc.

**New Helper Function:**
```bash
# install_on_windows [--prefer-choco] [--prefer-scoop] <pkg> [<pkg2>] ...
#
# Attempts to install packages on Windows using available package managers.
# Priority order: winget > chocolatey > scoop
# Flags allow preferring alternative package managers.
function install_on_windows() {
    # ...
}
```

**Package Manager Priority:**
1. **winget** (Windows Package Manager) - Built into Windows 10/11, official Microsoft tool
2. **Chocolatey** - Most popular third-party Windows package manager
3. **Scoop** - Developer-focused package manager, installs to user directory

### Implementation Steps

1. **Add Windows package manager mocks** to `tests/helpers/install-mocks.sh`:
   - Mock `winget` commands (search, install)
   - Mock `choco` commands (search, install)
   - Mock `scoop` commands (search, install)

2. **Create `install_on_windows()` function:**
   - Parse flags (`--prefer-choco`, `--prefer-scoop`)
   - Validate that at least one package name is provided
   - Try each package manager in priority order
   - Support multiple package name variants (like other `install_on_*` functions)

3. **Update `install_jq()`:**
   - Add `elif is_windows; then install_on_windows "jq"` branch
   - Package names: `jq` (winget: `jqlang.jq`, choco: `jq`, scoop: `jq`)

4. **Update `install_curl()`:**
   - Add `elif is_windows; then install_on_windows "curl"` branch
   - Note: curl is typically pre-installed on Windows 10+, but function should handle installation if needed
   - Package names: `curl` (winget: `cURL.cURL`, choco: `curl`, scoop: `curl`)

5. **Update `install_yq()`:**
   - Add `elif is_windows; then install_on_windows "yq"` branch
   - Package names: `yq` (winget: `MikeFarah.yq`, choco: `yq`, scoop: `yq`)

### Type Definitions

N/A - This is a bash shell script project.

### Edge Cases

1. **No package manager available:** Return error with helpful message
2. **Package name variants:** Some packages have different names across managers (e.g., `jqlang.jq` vs `jq`)
3. **WSL vs native Windows:** The `is_windows()` function already handles this distinction
4. **Elevated permissions:** winget and chocolatey may require admin rights; scoop typically doesn't
5. **PowerShell execution policy:** May affect script-based installers

### Dependencies

- No new dependencies required
- Existing `is_windows()` function from `utils/os.sh` is already available
- Existing color/logging utilities are already available

### Package Name Mapping

| Tool | winget ID | Chocolatey | Scoop |
|------|-----------|------------|-------|
| jq   | `jqlang.jq` | `jq` | `jq` |
| curl | `cURL.cURL` | `curl` | `curl` |
| yq   | `MikeFarah.yq` | `yq` | `yq` |

---

## Test Details

*To be filled in after Step 3*

---

## Review Findings

*To be filled in after Step 5*
